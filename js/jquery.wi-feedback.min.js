!function(e){e(document).ready(function(){e.fn.wiFeedBack=function(i){function d(){var i=0;return n.find("input, select, textarea").each(function(){e(this).get(0).checkValidity()||i++}),0==i?!0:!1}function l(){n.find("input, select, textarea").each(function(){e(this).val("")})}var s,n=this,a=Math.floor(899999*Math.random()+1e5),t=e.extend({fbScript:"/wi-feedback.php",fbLink:".wi-fb-link",fbDelegate:!1,fbBeforeOpen:null,fbBeforeClose:null,fbColor:"#00aff0",fbTheme:!0},i);if(t.fbColor&&e("head").append('<style wi-fb-id="'+a+'">.wi-fb-'+a+" .wi-fb-msg-sending,.wi-fb-"+a+" .wi-fb-msg-sent,.wi-fb-"+a+" .wi-fb-title h2,.wi-fb-"+a+" .wi-fb-title .h2{color:"+t.fbColor+"}.wi-fb-"+a+" .wi-fb-btn button{background:"+t.fbColor+"}</style>"),n.addClass("wi-fb wi-fb-"+a).attr("wi-fb-id",a),t.fbTheme&&(n.find("h2, .h2").wrap('<div class="wi-fb-title"></div>'),n.find("h3, .h3").wrap('<div class="wi-fb-text"></div>'),n.find("input, select, textarea").wrap('<div class="wi-fb-line"></div>'),n.find("input, select, textarea").each(function(){var i=e(this).attr("data-wi-fb-label");""!=i&&"undefined"!=typeof i&&(e(this).parent().prepend("<label>"+i+"</label>"),e(this).prop("required")&&e(this).parent().find("label").append("<span> *</span>"))}),n.find("button").wrap('<div class="wi-fb-btn"></div>')),/ru/i.test(e("html").attr("lang"))?n.append('<div class="wi-fb-spinner"></div><div class="wi-fb-msg-invalid">Отмеченные поля заполнены некорректно</div><div class="wi-fb-msg-sending">Идет отправка данных...</div><div class="wi-fb-msg-sent">Ваша заявка принята!</div><div class="wi-fb-msg-notsent">При отправке данных произошла ошибка</div>'):n.append('<div class="wi-fb-spinner"></div><div class="wi-fb-msg-invalid">Marked fields are required</div><div class="wi-fb-msg-sending">Sending data...</div><div class="wi-fb-msg-sent">Your request is sent!</div><div class="wi-fb-msg-notsent">An error occurred while sending data</div>'),n.find(".wi-fb-btn button, .wi-fb-send").on("click",function(){if(n.removeClass("invalid sent notsent"),d()){var i={},a=[];n.find("input, select, textarea").each(function(){a.push({name:e(this).attr("data-wi-fb-caption")||e(this).attr("wi-fb-caption")||e(this).attr("name"),value:e(this).val()})}),s&&a.push({name:"Дополнительная информация",value:s}),a.push({name:"Адрес страницы",value:window.location.href}),i.action="feedback",i.fields=a,n.addClass("sending"),e.ajax({url:t.fbScript,type:"POST",data:i,cache:!1,success:function(e){"1"==e?(n.removeClass("sending"),n.addClass("sent"),l()):(n.removeClass("sending"),n.addClass("notsent"))},error:function(){n.removeClass("sending"),n.addClass("notsent")}})}else n.addClass("invalid")}),t.fbLink){n.addClass("wi-fb-modal");var f={};t.fbDelegate&&(f.delegate=t.fbLink),f.type="inline",f.callbacks={},f.fixedContentPos=!0,f.mainClass="mfp-fade",f.removalDelay=300,"function"==typeof t.fbBeforeOpen&&(f.callbacks.open=t.fbBeforeOpen),"function"==typeof t.fbBeforeClose&&(f.callbacks.close=t.fbBeforeClose),t.fbDelegate?e("body").magnificPopup(f):e(t.fbLink).magnificPopup(f),e("body").on("click",t.fbLink,function(){n.removeClass("sent notsent"),s=e(this).attr("data-wi-fb-info")||e(this).attr("wi-fb-info")||""})}return a}})}(jQuery);